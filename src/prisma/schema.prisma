// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// =====================
// AUTH & USER
// =====================

model User {
  id            Int     @id @default(autoincrement())
  email         String  @unique
  name          String
  password      String
  phone         String  @unique
  avatar        String?
  role          String  @default("user") // "user", "admin", "owner"
  status        String  @default("active") // "active", "inactive", "suspended"
  lastLogin     DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  subscription  Subscription?
  dependents    Dependent[]
  cardapio      Cardapio[]
  estoque       EstoqueItem[]
  atendimentos  Atendimento[]
  caixas        Caixa[]
}

model Subscription {
  id            Int     @id @default(autoincrement())
  userId        Int     @unique
  user          User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  plan          String  // "free", "basic", "professional", "enterprise"
  status        String  @default("active") // "active", "inactive", "cancelled"
  mpId          String? // Mercado Pago ID
  preco         Decimal @default(0)
  startDate     DateTime @default(now())
  endDate       DateTime?
  renewalDate   DateTime?
  autoRenew     Boolean @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([userId])
}

// =====================
// TEAM & PERMISSIONS
// =====================

model Dependent {
  id            Int     @id @default(autoincrement())
  name          String
  email         String?
  phone         String?
  role          String  // "manager", "employee", "viewer"
  permissions   String? // JSON array de permissões
  userId        Int
  user          User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  atendimentos  Atendimento[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([userId])
  @@unique([email, userId])
}

// =====================
// MÓDULO: CARDÁPIO/MENU
// =====================

model Cardapio {
  id            Int     @id @default(autoincrement())
  userId        Int
  user          User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  nome          String
  descricao     String?
  preco         Decimal
  categoria     String? // "comida", "bebida", "sobremesa"
  imagem        String?
  ativo         Boolean @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([userId])
  @@index([categoria])
}

// =====================
// MÓDULO: ESTOQUE
// =====================

model EstoqueItem {
  id            Int     @id @default(autoincrement())
  userId        Int
  user          User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  nome          String
  quantidade    Int     @default(0)
  categoria     String?
  fornecedor    String?
  dataCadastro  DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([userId])
}

// =====================
// MÓDULO: ATENDIMENTO
// =====================

model Atendimento {
  id            Int       @id @default(autoincrement())
  userId        Int
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  dependentId   Int
  dependent     Dependent @relation(fields: [dependentId], references: [id], onDelete: Cascade)
  pedido        String
  descricao     String?
  status        String    @default("aberto")      // "aberto" | "em_progresso" | "entregue" | "cancelado"
  entregue      Boolean   @default(false)
  entregueAt    DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([userId])
  @@index([dependentId])
  @@index([status])
}

// =====================
// MÓDULO: FINANCEIRO
// =====================

model Caixa {
  id             Int      @id @default(autoincrement())
  userId         Int
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  valor          Decimal
  descricao      String?
  metodo         String?  // "dinheiro" | "cartao" | "pix" |
  referencia     String?  // mesa
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([userId])
}

